<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Frequently Asked Questions · Optimization.jl</title><script async src="https://www.googletagmanager.com/gtag/js?id=UA-90474609-3"></script><script>  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'UA-90474609-3', {'page_path': location.pathname + location.search + location.hash});
</script><script data-outdated-warner src="../../assets/warner.js"></script><link rel="canonical" href="https://docs.sciml.ai/Optimization/stable/API/FAQ/"/><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script><link href="../../assets/favicon.ico" rel="icon" type="image/x-icon"/></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="Optimization.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../../">Optimization.jl</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Optimization.jl: A Unified Optimization Package</a></li><li><a class="tocitem" href="../../getting_started/">Getting Started with Optimization in Julia</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../../tutorials/minibatch/">Data Iterators and Minibatching</a></li><li><a class="tocitem" href="../../tutorials/symbolic/">Symbolic Problem Building with ModelingToolkit</a></li><li><a class="tocitem" href="../../tutorials/constraints/">Using Equality and Inequality Constraints</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples/rosenbrock/">Solving the Rosenbrock Problem in &gt;10 Ways</a></li></ul></li><li><span class="tocitem">Basics</span><ul><li><a class="tocitem" href="../optimization_problem/">Defining OptimizationProblems</a></li><li><a class="tocitem" href="../optimization_function/">OptimizationFunction</a></li><li><a class="tocitem" href="../solve/">Common Solver Options (Solve Keyword Arguments)</a></li><li><a class="tocitem" href="../optimization_solution/">Optimization Solutions</a></li><li><a class="tocitem" href="../modelingtoolkit/">ModelingToolkit Integration</a></li><li class="is-active"><a class="tocitem" href>Frequently Asked Questions</a><ul class="internal"><li><a class="tocitem" href="#The-Solver-Seems-to-Violate-Constraints-During-the-Optimization,-Causing-DomainErrors,-What-Can-I-Do-About-That?"><span>The Solver Seems to Violate Constraints During the Optimization, Causing <code>DomainError</code>s, What Can I Do About That?</span></a></li><li><a class="tocitem" href="#What-are-the-advantages-and-disadvantages-of-using-the-ModelingToolkit.jl-or-other-symbolic-interfaces-(JuMP)?"><span>What are the advantages and disadvantages of using the ModelingToolkit.jl or other symbolic interfaces (JuMP)?</span></a></li></ul></li></ul></li><li><span class="tocitem">Optimizer Packages</span><ul><li><a class="tocitem" href="../../optimization_packages/blackboxoptim/">BlackBoxOptim.jl</a></li><li><a class="tocitem" href="../../optimization_packages/cmaevolutionstrategy/">CMAEvolutionStrategy.jl</a></li><li><a class="tocitem" href="../../optimization_packages/evolutionary/">Evolutionary.jl</a></li><li><a class="tocitem" href="../../optimization_packages/flux/">Flux.jl</a></li><li><a class="tocitem" href="../../optimization_packages/gcmaes/">GCMAES.jl</a></li><li><a class="tocitem" href="../../optimization_packages/mathoptinterface/">MathOptInterface.jl</a></li><li><a class="tocitem" href="../../optimization_packages/metaheuristics/">Metaheuristics.jl</a></li><li><a class="tocitem" href="../../optimization_packages/multistartoptimization/">MultistartOptimization.jl</a></li><li><a class="tocitem" href="../../optimization_packages/nlopt/">NLopt.jl</a></li><li><a class="tocitem" href="../../optimization_packages/nomad/">NOMAD.jl</a></li><li><a class="tocitem" href="../../optimization_packages/nonconvex/">Nonconvex.jl</a></li><li><a class="tocitem" href="../../optimization_packages/optim/">Optim.jl</a></li><li><a class="tocitem" href="../../optimization_packages/optimisers/">Optimisers.jl</a></li><li><a class="tocitem" href="../../optimization_packages/quaddirect/">QuadDIRECT.jl</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Basics</a></li><li class="is-active"><a href>Frequently Asked Questions</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Frequently Asked Questions</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/SciML/Optimization.jl/blob/master/docs/src/API/FAQ.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Frequently-Asked-Questions"><a class="docs-heading-anchor" href="#Frequently-Asked-Questions">Frequently Asked Questions</a><a id="Frequently-Asked-Questions-1"></a><a class="docs-heading-anchor-permalink" href="#Frequently-Asked-Questions" title="Permalink"></a></h1><h2 id="The-Solver-Seems-to-Violate-Constraints-During-the-Optimization,-Causing-DomainErrors,-What-Can-I-Do-About-That?"><a class="docs-heading-anchor" href="#The-Solver-Seems-to-Violate-Constraints-During-the-Optimization,-Causing-DomainErrors,-What-Can-I-Do-About-That?">The Solver Seems to Violate Constraints During the Optimization, Causing <code>DomainError</code>s, What Can I Do About That?</a><a id="The-Solver-Seems-to-Violate-Constraints-During-the-Optimization,-Causing-DomainErrors,-What-Can-I-Do-About-That?-1"></a><a class="docs-heading-anchor-permalink" href="#The-Solver-Seems-to-Violate-Constraints-During-the-Optimization,-Causing-DomainErrors,-What-Can-I-Do-About-That?" title="Permalink"></a></h2><p>During the optimization, optimizers use slack variables to relax the solution to the constraints. Because of this, there is no guarantee that for an arbitrary optimizer the steps will all satisfy the constraints during the optimization. In many cases, this can cause one&#39;s objective function code throw a <code>DomainError</code> if it is evaluated outside of its acceptable zone. For example, <code>log(-1)</code> gives:</p><pre><code class="nohighlight hljs">julia&gt; log(-1)
ERROR: DomainError with -1.0:
log will only return a complex result if called with a complex argument. Try log(Complex(x)).</code></pre><p>To handle this, one should not assume that the variables will always satisfy the constraints on each step. There are three general ways to handle this better:</p><ol><li>Use <a href="https://github.com/JuliaMath/NaNMath.jl">NaNMath.jl</a></li><li>Process variables before domain-restricted calls</li><li>Use a domain transformation</li></ol><p>NaNMath.jl gives alternative implementations of standard math functions like <code>log</code> and <code>sqrt</code> in forms that do not throw <code>DomainError</code>s but rather return <code>NaN</code>s. The optimizers will be able to handle the NaNs gracefully and recover, allowing for many of these cases to be solved without further modification. Note that this is done <a href="https://discourse.julialang.org/t/optimizationmoi-ipopt-violating-inequality-constraint/92608/">internally in JuMP.jl, and thus if a case is working with JuMP and not Optimization.jl </a> this may be the reason for the difference.</p><p>Alternatively, one can pre-process the values directly. For example, <code>log(abs(x))</code> is guaranteed to work. If one does this, there are two things to make note of. One is that the solution will not be transformed, and thus the transformation should be applied on <code>sol.u</code> as well. For example, the solution could find an optima for <code>x = -2</code>, and one should manually change this to <code>x = 2</code> if the <code>abs</code> version is used within the objective function. Note that many functions for this will introduce a discontinuity in the derivative which can affect the optimization process.</p><p>Finally and relatedly, one can write the optimization with domain transformations in order to allow the optimization to take place in the full real set. For example, instead of optimizing <code>x in [0,Inf]</code>, one can optimize <code>exp(x) in [0,Inf]</code> and thus <code>x in [-Inf, Inf]</code> is allowed without any bounds. To do this, you would simply add the transformations to the top of the objective function:</p><pre><code class="language-julia hljs">function my_objective(u)
    x = exp(u[1])
    # ... use x
end</code></pre><p>When the optimization is done, <code>sol.u[1]</code> will be <code>exp(x)</code> and thus <code>log(sol.u[1])</code> will be the optimal value for <code>x</code>. There exist packages in the Julia ecosystem which make it easier to keep track of these domain transformations and their inverses for more general domains. See <a href="https://github.com/tpapp/TransformVariables.jl">TransformVariables.jl</a> and <a href="https://github.com/TuringLang/Bijectors.jl">Bijectors.jl</a> for high level interfaces for this.</p><p>While this can allow an optimization with constraints to be rewritten as one without constraints, note that this can change the numerical properties of the solve which can either improve or decrease the numerical stability in a case-by-case basis. Thus while a solution, one should be aware that it could make the optimization more difficult in some cases.</p><h2 id="What-are-the-advantages-and-disadvantages-of-using-the-ModelingToolkit.jl-or-other-symbolic-interfaces-(JuMP)?"><a class="docs-heading-anchor" href="#What-are-the-advantages-and-disadvantages-of-using-the-ModelingToolkit.jl-or-other-symbolic-interfaces-(JuMP)?">What are the advantages and disadvantages of using the ModelingToolkit.jl or other symbolic interfaces (JuMP)?</a><a id="What-are-the-advantages-and-disadvantages-of-using-the-ModelingToolkit.jl-or-other-symbolic-interfaces-(JuMP)?-1"></a><a class="docs-heading-anchor-permalink" href="#What-are-the-advantages-and-disadvantages-of-using-the-ModelingToolkit.jl-or-other-symbolic-interfaces-(JuMP)?" title="Permalink"></a></h2><p>The purely numerical function interfaces of Optimization.jl has its pros and cons. The major pro of the direct Optimization.jl interface is that it can take arbitrary Julia programs. If you have an optimization defined over a program, like a Neural ODE or something that calls out to web servers, then these advanced setups rarely work within specialized symbolic environments for optimization. Direct usage of Optimization.jl is thus the preferred route for this kind of problem, and is the popular choice in the Julia ecosystem for these cases due to the simplicity of use.</p><p>However, symbolic interfaces are smart, and they may know more than you for how to make this optimization faster. And symbolic interfaces are willing to do &quot;tedious work&quot; in order to make the optimization more efficient. For example, the ModelingToolkit integration with Optimization.jl will do many simplifications when <code>structural_simplify</code> is called. One of them is tearing on the constraints. To understand the tearing process, assume that we had nonlinear constraints of the form:</p><pre><code class="nohighlight hljs">    0 ~ u1 - sin(u5) * h,
    0 ~ u2 - cos(u1),
    0 ~ u3 - hypot(u1, u2),
    0 ~ u4 - hypot(u2, u3),</code></pre><p>If these were the constraints, one can write <code>u1 = sin(u5) * h</code> and substitute <code>u1</code> for this value in the objective function. If this is done, then <code>u1</code> does not need to be solved for, the optimization has one less state variable and one less constraint. One can continue this process all the way to a bunch of functions:</p><pre><code class="language-julia hljs">u1 = f1(u5)
u2 = f2(u1)
u3 = f3(u1, u2)
u4 = f4(u2, u3)</code></pre><p>and thus if the objective function was the function of these 5 variables and 4 constraints, ModelingToolkit.jl will transform it into system of 1 variable with no constraints, allowing unconstrained optimization on a smaller system. This will both be faster and numerically easier.</p><p><a href="https://jump.dev/JuMP.jl/stable/">JuMP.jl</a> is another symbolic interface. While it does not include these tearing and symbolic simplification passes, it does include the ability to specialize the solution process. For example, it can treat linear optimization problems, quadratic optimization problem, convex optimization problems, etc. in specific ways that are more efficient than a general nonlinear interface. For more information on the types of special solves that are allowed with JuMP, see <a href="https://jump.dev/JuMP.jl/stable/installation/#Supported-solvers">this page</a>.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../modelingtoolkit/">« ModelingToolkit Integration</a><a class="docs-footer-nextpage" href="../../optimization_packages/blackboxoptim/">BlackBoxOptim.jl »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.24 on <span class="colophon-date" title="Sunday 26 March 2023 13:47">Sunday 26 March 2023</span>. Using Julia version 1.8.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
